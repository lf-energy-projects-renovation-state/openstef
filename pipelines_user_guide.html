<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pipelines user guide &#8212; OpenSTEF  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script src="_static/documentation_options.js?v=8a448e45"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pipelines_user_guide';</script>
    <link rel="icon" href="_static/openstef.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="index.html">

  
  
  
  
  
  
  

  
    <img src="_static/logo_openstef_small.png" class="logo__image only-light" alt="Logo image">
    <img src="_static/logo_openstef_small.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="about_openstef.html">
                        About OpenSTEF
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="user_guides.html">
                        User guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="architecture_methodology_components.html">
                        Architecture, Methodology, and Components
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api_reference.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="community.html">
                        Community
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/OpenSTEF/openstef" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/openstef/" title="Pypi" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fas fa-gift"></i></span>
            <label class="sr-only">Pypi</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://www.lfenergy.org/projects/openstef/" title="LFE Homepage" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fas fa-bolt"></i></span>
            <label class="sr-only">LFE Homepage</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="about_openstef.html">
                        About OpenSTEF
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="user_guides.html">
                        User guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="architecture_methodology_components.html">
                        Architecture, Methodology, and Components
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api_reference.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="community.html">
                        Community
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/OpenSTEF/openstef" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/openstef/" title="Pypi" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fas fa-gift"></i></span>
            <label class="sr-only">Pypi</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://www.lfenergy.org/projects/openstef/" title="LFE Homepage" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fas fa-bolt"></i></span>
            <label class="sr-only">LFE Homepage</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="pipelines-user-guide">
<span id="pipeline-user-guide"></span><h1>Pipelines user guide<a class="headerlink" href="#pipelines-user-guide" title="Link to this heading">¶</a></h1>
<p>As mentioned in the <a class="reference internal" href="architecture_methodology_components.html#concepts"><span class="std std-ref">concepts</span></a> section, tasks are an extension of pipelines, that include getting data from a database,
raising task exceptions, and writing data to a database. In an operational setting, both tasks and pipelines can be used.
The main difference is that an operational application that leverages OpenSTEF’s tasks fuctionality is easier to implement,
whereas the pipeline functionality offers more flexibility in terms of design and implementation in addition to offering more scalability.</p>
<p>To illustrate the task as well as the pipeline <a class="reference internal" href="architecture_methodology_components.html#concepts"><span class="std std-ref">concept</span></a>, code snippets for both implementations are presented below.
These code snippets show two different ways in which OpenSTEF’s pipeline functionality can be integrated within an application that runs in an operational setting.</p>
<section id="task-implementation">
<h2>Task implementation<a class="headerlink" href="#task-implementation" title="Link to this heading">¶</a></h2>
<p>Let’s first have a look at the task implementation, which is also the way it is done in the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">GitHub repository containing the reference implementation</a>.
In the case that model training, hyperparameter tuning, or forecasting is supposed to be ran according to a certain schedule, using CronJobs for example,
the task implementation is easy to set up.
However this implementation’s scalability is limited. Additionally, this implementation relies on the <a class="reference external" href="https://pypi.org/project/openstef-dbc/">the OpenSTEF database connector</a>, <code class="docutils literal notranslate"><span class="pre">openstef-dbc</span></code>,
meaning that the databases have to be set up according to the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">reference implementation</a>.
Below, code snippets are shown for different types of tasks that demonstrate the use of OpenSTEF’s task functionality.</p>
<p>Note that, apart from the imports, the implementation is the same for each type of task. The <cite>config</cite> object is a <cite>pydantic.BaseSettings</cite> object holding all relevanyt configuration such as usernames, secrets and hosts etc.</p>
<section id="train-model-task-implementation">
<h3>Train model task implementation<a class="headerlink" href="#train-model-task-implementation" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">train_model</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="create-forecast-task-implementation">
<h3>Create forecast task implementation<a class="headerlink" href="#create-forecast-task-implementation" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">create_forecast</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="optimize-hyperparameters-task-implementation">
<h3>Optimize hyperparameters task implementation<a class="headerlink" href="#optimize-hyperparameters-task-implementation" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">optimize_hyperparameters</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="create-components-forecast-task-implementation">
<h3>Create components forecast task implementation<a class="headerlink" href="#create-components-forecast-task-implementation" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">create_components_forecast</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="create-base-case-forecast-task-implementation">
<h3>Create base case forecast task implementation<a class="headerlink" href="#create-base-case-forecast-task-implementation" title="Link to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">openstef.tasks</span> <span class="kn">import</span> <span class="n">create_basecase_forecast</span> <span class="k">as</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.database</span> <span class="kn">import</span> <span class="n">DataBase</span>
<span class="kn">from</span> <span class="nn">openstef_dbc.log</span> <span class="kn">import</span> <span class="n">logging</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize logging</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># Initialize database connection</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">DataBase</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="pipeline-implementation">
<h2>Pipeline implementation<a class="headerlink" href="#pipeline-implementation" title="Link to this heading">¶</a></h2>
<p>The pipeline implementation does not rely on <a class="reference external" href="https://pypi.org/project/openstef-dbc/">the OpenSTEF database connector</a>, <code class="docutils literal notranslate"><span class="pre">openstef-dbc</span></code>.
Therefore, pipelines can be used together with any kind of database setup, unlike tasks,
which require databases to be implemented according to the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">reference implementation</a>.</p>
<p>A more scalable and arguably more neat set up than the <a class="reference external" href="https://github.com/OpenSTEF/openstef-reference">reference implementation</a>,
is to expose the OpenSTEF pipeline functionality through an API,
for instance by using the <a class="reference external" href="https://fastapi.tiangolo.com/">FastAPI framework</a>.
The code snippet below shows how OpenSTEF pipelines can be integrated into an API using the
<a class="reference external" href="https://mpuig.github.io/Notes/fastapi_basics/02.repository_pattern/">repository pattern</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">openstef.data_classes.model_specifications</span> <span class="kn">import</span> <span class="n">ModelSpecificationDataClass</span>
<span class="kn">from</span> <span class="nn">openstef.data_classes.prediction_job</span> <span class="kn">import</span> <span class="n">PredictionJobDataClass</span>
<span class="kn">from</span> <span class="nn">openstef.metrics.reporter</span> <span class="kn">import</span> <span class="n">Report</span>
<span class="kn">from</span> <span class="nn">openstef.model.regressors.regressor</span> <span class="kn">import</span> <span class="n">OpenstfRegressor</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.create_basecase_forecast</span> <span class="kn">import</span> <span class="n">create_basecase_forecast_pipeline</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.create_forecast</span> <span class="kn">import</span> <span class="n">create_forecast_pipeline_core</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.optimize_hyperparameters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">optimize_hyperparameters_pipeline_core</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">openstef.pipeline.train_model</span> <span class="kn">import</span> <span class="n">train_model_pipeline_core</span>


<span class="k">class</span> <span class="nc">OpenstefRepository</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Repository that exposes function to interact with OpenSTEF pipelines.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">forecast_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">OpenstfRegressor</span><span class="p">,</span>
        <span class="n">modelspecs</span><span class="p">:</span> <span class="n">ModelSpecificationDataClass</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper around the forecast pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">create_forecast_pipeline_core</span><span class="p">(</span>
            <span class="n">prediction_job</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">modelspecs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">basecase_forecast_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper around the basecase forecast pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">create_basecase_forecast_pipeline</span><span class="p">(</span><span class="n">prediction_job</span><span class="p">,</span> <span class="n">input_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">train_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">modelspecs</span><span class="p">:</span> <span class="n">ModelSpecificationDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">horizons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">old_model</span><span class="p">:</span> <span class="n">OpenstfRegressor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">OpenstfRegressor</span><span class="p">,</span>
        <span class="n">Report</span><span class="p">,</span>
        <span class="n">ModelSpecificationDataClass</span><span class="p">,</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper around the train model pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">train_model_pipeline_core</span><span class="p">(</span>
            <span class="n">prediction_job</span><span class="p">,</span>
            <span class="n">modelspecs</span><span class="p">,</span>
            <span class="n">input_data</span><span class="p">,</span>
            <span class="n">old_model</span><span class="p">,</span>
            <span class="n">horizons</span><span class="o">=</span><span class="n">horizons</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">optimize_hyperparameters_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prediction_job</span><span class="p">:</span> <span class="n">PredictionJobDataClass</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">horizons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">OpenstfRegressor</span><span class="p">,</span> <span class="n">ModelSpecificationDataClass</span><span class="p">,</span> <span class="n">Report</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper around the optimize hyperparameters pipeline of OpenSTEF.</span>
<span class="sd">        The input_data should contain a `load` column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">optimize_hyperparameters_pipeline_core</span><span class="p">(</span>
            <span class="n">prediction_job</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">horizons</span><span class="p">,</span> <span class="n">n_trials</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#task-implementation">
   Task implementation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-model-task-implementation">
     Train model task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-forecast-task-implementation">
     Create forecast task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimize-hyperparameters-task-implementation">
     Optimize hyperparameters task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-components-forecast-task-implementation">
     Create components forecast task implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-base-case-forecast-task-implementation">
     Create base case forecast task implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pipeline-implementation">
   Pipeline implementation
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="_sources/pipelines_user_guide.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2017-2023 Contributors to the OpenSTEF project.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.3.7.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>